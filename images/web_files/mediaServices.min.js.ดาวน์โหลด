define("mediaServices",["lodash","constants","util","stateManagement","media-manager-api","image-client-api","coreBi"],function(C,e,A,P,a,u,t){"use strict";var I=t.events.singleVideoPlayer,i=A.backgroundUtils,F=i.getMediaPlayerVideoObject,L=i.getChangeVideoBiEventFields,R=i.getStoryboardDisplayValue,w=P.editorPlugins.userPreferences.actions.setSessionUserPreferences,r=P.editorPlugins.userPreferences.selectors.getSessionUserPreferences,m=P.editorPlugins.userPreferences.selectors.getMediaPath,o=e.CLIPART_DATA_KEYS,n=e.VECTOR_IMAGE_DEFAULTS,g=n.VECTOR_IMAGE_CATEGORY,p=n.VECTOR_SHAPE_DEFAULT_PATH,h=n.VECTOR_ART_DEFAULT_PATH,_="change_basic_shape";function s(e){var a=e.split("/");return 2===a.length?parseFloat(a[0])/parseFloat(a[1]):parseFloat(a[0])}function c(e){return 50<s(e)}function l(e){return e&&c(e)?30/s(e):1}return{create:function(T){function E(){var e=window.document.querySelector("#editor");if(e){var a=window.document,t=a.documentElement.scrollTop||a.body.scrollTop;e.focus(),a.documentElement.scrollTop=a.body.scrollTop=t}}return{initMediaManager:function(e){T.mediaServices.mediaManager=a.create(C.assign(e,{origin:a.origins.EDITOR}))},mediaManager:null,hasSlowMo:c,getPlaybackSpeedByFPS:l,setFocusToEditor:E,changeWPhoto:function(l){var d=A.imageTransform.fittingTypes,g=T.components.data.get(l),e=T.store,p=e.dispatch,a=(0,e.getState)(),t=m(g.uri)(a);T.mediaServices.mediaManager.open(T.mediaServices.mediaManager.categories.IMAGE,"change_image",{translation:{title:A.translate("Image_Media_Choose_Image"),submitButton:A.translate("MMGR_submitbutton_onstage_image_uploads_choose")},path:t,multiSelect:!1,callback:function(e,a){if(e){var t=C.head(e),i=T.components.layout.get(l),n=T.components.properties.get(l).displayMode,o=t.width,r=t.height,s={width:o,height:r,uri:t.fileName,name:t.title,alt:t.title,crop:null,focalPoint:null,originalImageDataRef:null};if(g.crop&&T.imageCrop.isCropAllowed(s.uri)&&!A.url.isExternalUrl(s.uri)){var c=function(e,a,t,i,n){if(n!==u.fittingTypes.SCALE_TO_FILL&&n!==u.fittingTypes.LEGACY_FULL)return null;var o=Math.min(t/e,i/a),r=e*o,s=a*o;return{width:Math.round(r),height:Math.round(s),x:Math.round((t-r)/2),y:Math.round((i-s)/2)}}(i.width,i.height,o,r,n);s.crop=C.assign({},g.crop,c)}p(w("last_media_path_"+s.uri,a.path)),T.components.data.update(l,s,!0),n===A.imageTransform.fittingTypes.LEGACY_FULL&&T.components.properties.update(l,{displayMode:d.SCALE_TO_FILL},!0),T.history.add("Change Image"),E()}}})},changeVectorImage:function(n,e,a,o){var t=T.store.getState(),r=T.components.data.get(n),i=C.get(r,["svgId"]),s=T.media.vectorImage.getSvgInfoFromCache(i).svgType,c="shape"===s?p:h,l="shape"===s?_:"change_vector_art",d=m(i)(t)||a||c;T.mediaServices.mediaManager.open(T.mediaServices.mediaManager.categories[e||g],l,{multiSelect:!1,callback:function(e,a){if(!C.isEmpty(e)){var t=C.get(e,[0,"title"],""),i=C.get(e,[0,"uri"]);A.vectorImageUtils.replaceVectorImage(T,n,r,t,i,o),T.store.dispatch(w("last_media_path_"+i,a.path||"")),E()}},path:d})},changeClipArt:function(i,e){var a=T.components.data.get(i),t=T.store.getState(),n=m(a.uri)(t);T.mediaServices.mediaManager.open(e,{multiSelect:!1,translation:{submitButton:A.translate("MMGR_submitbutton_onstage_clipart_freeclipart_choose")},path:n,callback:function(e,a){if(e){var t=C.pick(e[0],o);t.uri=e[0].fileName,t.originalImageDataRef=null,t.crop=null,T.store.dispatch(w("last_media_path_"+t.uri,a.path)),T.components.data.update(i,t,!0),T.history.add("Change Clipart"),E()}}})},changeVideo:function(v){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:T.mediaServices.mediaManager.categories.VIDEO,a=T.store,y=a.dispatch,t=a.getState,S=T.components.design.get(v),b=T.components.properties.get(v),M=T.components.layout.get(v),i=C.get(S.background,["mediaRef","videoId"],""),n=C.get(S.background,["mediaRef","mediaFeatures"],[]),o=r("last_media_path_"+i)(t());!o&&C.includes(n,"alpha")&&(o="public/338f22d8-60f8-4470-8dd5-ed4d0e9bf3e1/78b950e1-c26a-4ab4-92c5-9bbc23a8525f"),T.mediaServices.mediaManager.open(e,"change_video_box",{multiSelect:!1,callback:function(e,a){if(e){var t=C.head(e),i=F(t,a);if(C.includes(i.mediaFeatures,"alpha")){var n=i.qualities[0].width/i.qualities[0].height,o=T.dsRead.components.layout.getLimits(C.isArray(v)?v[0]:v),r=C.assign({},o,M),s=A.layoutUtils.getLayoutWithAspectRatio(r,n,null);T.components.layout.update(v,s,!0)}var c,l,d,g,p=(c=S,l=i.mediaFeatures,d=C.includes(l,"alpha"),g=C.cloneDeep(c),d&&(g.cssStyle={cssBorder:null,cssBorderRadius:null,cssBoxShadow:null},g.background.imageOverlay=null,g.background.colorOverlay=""),g);p.background.mediaRef=i,T.components.design.update(v,p,!0);var u={};C.get(b,"autoplay")&&C.assign(u,{autoplay:!0,mute:!0}),T.components.properties.update(v,u);var m=T.components.getChildren(v),h=C.find(m,function(e){return"wysiwyg.viewer.components.MediaControls"===T.components.getType(e)}),_=T.components.properties.get(h),f=C.get(_,"showStoryboard");_.showStoryboard=R(i,f),T.components.properties.update(h,_,!0),T.history.add("Change Video"),T.store.dispatch(P.editorPlugins.bi.actions.event(I.video_player_video_changed,L(e[0],"video_player_gfpp"))),y(w("last_media_path_"+i.videoId,a.path||"")),E()}},path:o})},changeShape:function(i){var e=T.mediaServices;e.mediaManager.open(e.mediaManager.categories.SHAPE,_,{multiSelect:!1,callback:function(e){if(!C.isEmpty(e)){var a=A.svgUrlParser.parseSvgSkinFromUrl(e[0].fileUrl),t=T.components.style.get(i);a!==t.skin&&(t.skin=a,T.components.style.update(i,t),T.history.add("Change Shape"),E())}},translation:{submitButton:A.translate("Shape_Media_Change_Shape")}})}}}}});
//# sourceMappingURL=mediaServices.min.js.map